<!DOCTYPE html>

<html lang="fr" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>MOT MYSTÃˆRE ğŸ”®</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;800;900&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
/* â•â•â• RESET â•â•â• */
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html{height:100%}

/* â•â•â• VARIABLES THÃˆME â•â•â• */
[data-theme=â€œdarkâ€]{
â€“bg: #0e0e0e;
â€“surface: #1a1a1a;
â€“surface2: #252525;
â€“surface3: #2f2f2f;
â€“border: rgba(255,255,255,0.08);
â€“text: #ffffff;
â€“text2: #aaaaaa;
â€“text3: #666666;
â€“overlay: rgba(0,0,0,0.85);
}
[data-theme=â€œlightâ€]{
â€“bg: #f5f5f5;
â€“surface: #ffffff;
â€“surface2: #f0f0f0;
â€“surface3: #e8e8e8;
â€“border: rgba(0,0,0,0.08);
â€“text: #0e0e0e;
â€“text2: #555555;
â€“text3: #999999;
â€“overlay: rgba(0,0,0,0.6);
}

/* Accents (identiques dark/light) */
:root{
â€“pink: #fe2c55;
â€“pink2: #ff6b6b;
â€“cyan: #25f4ee;
â€“gold: #ffd700;
â€“purple: #a855f7;
â€“green: #1db954;
â€“r: 18px;
}

/* â•â•â• BASE â•â•â• */
body{
background:var(â€“bg);
color:var(â€“text);
font-family:â€˜Nunitoâ€™,sans-serif;
min-height:100vh;
overflow-x:hidden;
transition:background .3s,color .3s;
}

/* â•â•â• TIKTOK BG LINES â•â•â• */
body::before{
content:â€™â€™;position:fixed;inset:0;z-index:0;pointer-events:none;
background:
linear-gradient(var(â€“border) 1px,transparent 1px),
linear-gradient(90deg,var(â€“border) 1px,transparent 1px);
background-size:32px 32px;
opacity:.4;
}

/* â•â•â• GLOW BLOBS â•â•â• */
.blob{
position:fixed;border-radius:50%;filter:blur(80px);
pointer-events:none;z-index:0;opacity:.12;
}
.blob1{width:400px;height:400px;background:var(â€“pink);top:-100px;right:-100px;}
.blob2{width:350px;height:350px;background:var(â€“cyan);bottom:-80px;left:-80px;}
[data-theme=â€œlightâ€] .blob{opacity:.06;}

/* â•â•â• APP â•â•â• */
.app{
position:relative;z-index:1;
min-height:100vh;
display:flex;flex-direction:column;
align-items:center;justify-content:center;
padding:16px 14px 60px;
}

/* â•â•â• SCREENS â•â•â• */
.sc{display:none;width:100%;max-width:420px;flex-direction:column;align-items:center;gap:12px;animation:fadeUp .4s ease;}
.sc.on{display:flex;}
@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}

/* â•â•â• TOPBAR â•â•â• */
.topbar{
position:fixed;top:0;left:0;right:0;z-index:200;
display:flex;align-items:center;justify-content:space-between;
padding:10px 14px;
background:var(â€“bg);
border-bottom:1px solid var(â€“border);
backdrop-filter:blur(12px);
}
.topbar-logo{
font-family:â€˜Space Monoâ€™,monospace;font-size:13px;font-weight:700;
background:linear-gradient(90deg,var(â€“pink),var(â€“cyan));
-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
letter-spacing:1px;
}
.topbar-right{display:flex;gap:8px;align-items:center;}

/* â•â•â• BUTTONS TOPBAR â•â•â• */
.icon-btn{
background:var(â€“surface2);border:1px solid var(â€“border);
border-radius:50px;padding:6px 12px;
font-size:12px;font-weight:700;cursor:pointer;
font-family:â€˜Nunitoâ€™,sans-serif;color:var(â€“text2);
display:flex;align-items:center;gap:4px;transition:all .2s;
}
.icon-btn:hover{border-color:var(â€“pink);color:var(â€“text);}
#back-btn{display:none;}
#back-btn.vis{display:flex;}

/* â•â•â• LOGO ZONE â•â•â• */
.logo-zone{text-align:center;padding:8px 0;}
.logo-emoji{font-size:56px;display:block;margin-bottom:2px;animation:float 3s ease-in-out infinite;}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
.logo-name{
font-family:â€˜Space Monoâ€™,monospace;font-weight:700;
font-size:clamp(26px,8vw,42px);letter-spacing:2px;text-transform:uppercase;
background:linear-gradient(135deg,var(â€“pink),var(â€“cyan),var(â€“gold));
-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
line-height:1.1;
}
.logo-tag{
font-size:11px;letter-spacing:3px;text-transform:uppercase;
color:var(â€“text3);margin-top:6px;font-weight:700;
}

/* â•â•â• CARDS â•â•â• */
.card{
background:var(â€“surface);
border:1px solid var(â€“border);
border-radius:var(â€“r);
padding:20px 18px;
width:100%;
position:relative;overflow:hidden;
}
.card-pink{border-top:3px solid var(â€“pink);}
.card-cyan{border-top:3px solid var(â€“cyan);}
.card-gold{border-top:3px solid var(â€“gold);}
.card-purple{border-top:3px solid var(â€“purple);}

/* â•â•â• SECTION LABEL â•â•â• */
.slbl{
font-family:â€˜Space Monoâ€™,monospace;
font-size:9px;letter-spacing:3px;text-transform:uppercase;
color:var(â€“text3);margin-bottom:8px;display:block;font-weight:700;
}

/* â•â•â• INPUTS â•â•â• */
.inp{
width:100%;padding:13px 16px;
background:var(â€“surface2);border:1.5px solid var(â€“border);border-radius:12px;
color:var(â€“text);font-family:â€˜Nunitoâ€™,sans-serif;font-size:15px;font-weight:700;
outline:none;transition:border-color .2s,box-shadow .2s;
}
.inp:focus{border-color:var(â€“pink);box-shadow:0 0 0 3px rgba(254,44,85,.12);}
.inp::placeholder{color:var(â€“text3);font-weight:400;}

.inp-code{
text-align:center;font-family:â€˜Space Monoâ€™,monospace;
font-size:30px;font-weight:700;letter-spacing:10px;
background:var(â€“surface2);border:2px solid var(â€“border);border-radius:12px;
color:var(â€“gold);padding:14px;width:100%;outline:none;transition:border-color .2s;
}
.inp-code:focus{border-color:var(â€“gold);}

.sel{
width:100%;padding:13px 16px;background:var(â€“surface2);border:1.5px solid var(â€“border);
border-radius:12px;color:var(â€“text);font-family:â€˜Nunitoâ€™,sans-serif;font-size:14px;font-weight:700;
outline:none;cursor:pointer;appearance:none;-webkit-appearance:none;
background-image:url(â€œdata:image/svg+xml,%3Csvg xmlns=â€˜http://www.w3.org/2000/svgâ€™ width=â€˜12â€™ height=â€˜8â€™%3E%3Cpath d=â€˜M1 1l5 5 5-5â€™ stroke=â€™%23888â€™ stroke-width=â€˜2â€™ fill=â€˜noneâ€™ stroke-linecap=â€˜roundâ€™/%3E%3C/svg%3Eâ€);
background-repeat:no-repeat;background-position:right 14px center;
}
.sel option{background:var(â€“surface);}

.ta{
width:100%;min-height:80px;padding:13px 16px;
background:var(â€“surface2);border:1.5px solid var(â€“border);border-radius:12px;
color:var(â€“text);font-family:â€˜Nunitoâ€™,sans-serif;font-size:14px;font-weight:700;
outline:none;resize:none;transition:border-color .2s;line-height:1.5;
}
.ta:focus{border-color:var(â€“cyan);box-shadow:0 0 0 3px rgba(37,244,238,.1);}
.ta::placeholder{color:var(â€“text3);font-weight:400;}

/* â•â•â• BUTTONS â•â•â• */
.btn{
display:flex;align-items:center;justify-content:center;gap:8px;
padding:15px 20px;border-radius:50px;border:none;
font-family:â€˜Nunitoâ€™,sans-serif;font-weight:900;font-size:15px;
cursor:pointer;transition:all .18s;width:100%;
letter-spacing:.3px;position:relative;overflow:hidden;
}
.btn:active{transform:scale(.96);}
.btn:disabled{opacity:.35;cursor:not-allowed;}

.b-pink{
background:linear-gradient(135deg,var(â€“pink),#ff6b6b);
color:#fff;box-shadow:0 4px 20px rgba(254,44,85,.4);
}
.b-pink:hover{box-shadow:0 6px 28px rgba(254,44,85,.6);transform:translateY(-1px);}

.b-cyan{
background:linear-gradient(135deg,#0dd,var(â€“cyan));
color:#0a0a0a;box-shadow:0 4px 20px rgba(37,244,238,.3);
}
.b-cyan:hover{box-shadow:0 6px 28px rgba(37,244,238,.5);transform:translateY(-1px);}

.b-gold{
background:linear-gradient(135deg,#e6c200,var(â€“gold),#ffe84d);
color:#0a0a0a;box-shadow:0 4px 20px rgba(255,215,0,.35);
}
.b-gold:hover{box-shadow:0 6px 28px rgba(255,215,0,.55);transform:translateY(-1px);}

.b-ghost{
background:var(â€“surface2);color:var(â€“text2);border:1.5px solid var(â€“border);
}
.b-ghost:hover{color:var(â€“text);border-color:var(â€“text3);}
.b-sm{padding:10px 18px;font-size:13px;border-radius:50px;}

/* â•â•â• TIKTOK PILL BADGES â•â•â• */
.pill{
display:inline-flex;align-items:center;gap:4px;
padding:4px 12px;border-radius:50px;font-size:11px;font-weight:800;
letter-spacing:.5px;text-transform:uppercase;
}
.pill-pink{background:rgba(254,44,85,.15);color:var(â€“pink);border:1px solid rgba(254,44,85,.2);}
.pill-cyan{background:rgba(37,244,238,.12);color:var(â€“cyan);border:1px solid rgba(37,244,238,.18);}
.pill-gold{background:rgba(255,215,0,.12);color:var(â€“gold);border:1px solid rgba(255,215,0,.2);}
.pill-green{background:rgba(29,185,84,.12);color:var(â€“green);border:1px solid rgba(29,185,84,.2);}
.pill-purple{background:rgba(168,85,247,.12);color:var(â€“purple);border:1px solid rgba(168,85,247,.2);}

/* â•â•â• CODE BOX â•â•â• */
.codebox{
background:var(â€“surface2);border:2px solid rgba(255,215,0,.25);
border-radius:16px;padding:16px;text-align:center;width:100%;
}
#l-code{
display:block;
font-family:â€˜Space Monoâ€™,monospace;font-size:42px;font-weight:700;letter-spacing:12px;
color:var(â€“gold);text-shadow:0 0 20px rgba(255,215,0,.4);padding:4px 0;
}
.copyhint{font-size:10px;color:var(â€“text3);cursor:pointer;margin-top:5px;letter-spacing:2px;font-weight:700;transition:color .2s;}
.copyhint:hover{color:var(â€“cyan);}

/* â•â•â• PLAYER ROW â•â•â• */
.plist{display:flex;flex-direction:column;gap:6px;width:100%;}
.prow{
display:flex;align-items:center;gap:10px;
padding:11px 14px;background:var(â€“surface2);
border-radius:12px;border:1.5px solid var(â€“border);
}
.prow.me{border-color:rgba(254,44,85,.3);}
.prow.host{border-color:rgba(37,244,238,.3);}
.pav{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0;}
.pnm{font-weight:800;font-size:13px;flex:1;}
.pscore{font-family:â€˜Space Monoâ€™,monospace;font-size:12px;color:var(â€“gold);font-weight:700;}

/* â•â•â• DIFF TILES â•â•â• */
.diff-row{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;width:100%;}
.dtile{
padding:12px 6px;border-radius:12px;border:2px solid var(â€“border);
background:var(â€“surface2);cursor:pointer;text-align:center;
transition:all .18s;user-select:none;
}
.dtile *{pointer-events:none;}
.dtile .di{font-size:20px;display:block;margin-bottom:3px;}
.dtile .dn{font-size:10px;font-weight:900;display:block;letter-spacing:.5px;}
.dtile.on.de{border-color:var(â€“green);background:rgba(29,185,84,.08);}
.dtile.on.dm{border-color:var(â€“gold);background:rgba(255,215,0,.08);}
.dtile.on.dh{border-color:var(â€“pink);background:rgba(254,44,85,.08);}

/* â•â•â• CAT CHIPS â•â•â• */
.chips{display:flex;flex-wrap:wrap;gap:6px;width:100%;}
.chip{
padding:6px 12px;border-radius:50px;border:1.5px solid var(â€“border);
background:var(â€“surface2);cursor:pointer;font-size:11px;font-weight:800;
transition:all .18s;user-select:none;letter-spacing:.3px;color:var(â€“text2);
}
.chip *{pointer-events:none;}
.chip.on{border-color:var(â€“pink);color:var(â€“pink);background:rgba(254,44,85,.08);}

/* â•â•â• GAME TOPBAR â•â•â• */
.game-header{
position:sticky;top:0;z-index:10;
width:100%;background:var(â€“bg);border-bottom:1px solid var(â€“border);
padding:10px 14px 8px;display:flex;align-items:center;justify-content:space-between;
backdrop-filter:blur(12px);
}
.round-info{font-family:â€˜Space Monoâ€™,monospace;font-size:11px;color:var(â€“text2);font-weight:700;}

/* Timer ring */
.timer-ring{position:relative;width:44px;height:44px;flex-shrink:0;}
.timer-ring svg{transform:rotate(-90deg);}
.timer-ring circle{stroke-dasharray:120;stroke-dashoffset:0;transition:stroke-dashoffset 1s linear,stroke .4s;}
#timer-txt{
position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
font-family:â€˜Space Monoâ€™,monospace;font-size:13px;font-weight:700;
color:var(â€“cyan);
}

/* Progress bar */
.prog-bar{height:3px;background:var(â€“surface3);border-radius:4px;overflow:hidden;width:100%;}
.prog-fill{height:100%;background:linear-gradient(90deg,var(â€“pink),var(â€“cyan));border-radius:4px;transition:width .6s ease;}

/* â•â•â• WORD ZONE â•â•â• */
.word-zone{
background:var(â€“surface);border:1.5px solid var(â€“border);
border-radius:var(â€“r);padding:18px 16px;width:100%;
position:relative;overflow:hidden;
}
.word-zone::before{
content:â€™â€™;position:absolute;top:0;left:0;right:0;height:3px;
background:linear-gradient(90deg,var(â€“pink),var(â€“cyan),var(â€“gold));
}
.wz-meta{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;}
.blanks{display:flex;flex-wrap:wrap;gap:5px;justify-content:center;margin:10px 0 12px;}
.blank{
width:30px;height:36px;border-bottom:2.5px solid var(â€“text3);
display:flex;align-items:flex-end;justify-content:center;padding-bottom:3px;
font-family:â€˜Space Monoâ€™,monospace;font-size:18px;font-weight:700;
transition:all .3s;color:var(â€“text);
}
.blank.lit{border-color:var(â€“cyan);color:var(â€“cyan);animation:popL .4s cubic-bezier(.34,1.56,.64,1);}
.blank.space{width:14px;border:none;}
@keyframes popL{0%{transform:scale(0)}70%{transform:scale(1.25)}100%{transform:scale(1)}}
.word-meta-row{font-family:â€˜Space Monoâ€™,monospace;font-size:10px;color:var(â€“text3);text-align:center;letter-spacing:1px;}

/* â•â•â• MASTER ZONE â•â•â• */
.master-zone{
background:linear-gradient(135deg,rgba(37,244,238,.06),rgba(168,85,247,.06));
border:2px solid rgba(37,244,238,.2);border-radius:var(â€“r);
padding:18px 16px;width:100%;
}
.master-label{font-family:â€˜Space Monoâ€™,monospace;font-size:9px;letter-spacing:3px;color:var(â€“cyan);text-transform:uppercase;text-align:center;margin-bottom:10px;}
.master-word-display{
font-family:â€˜Space Monoâ€™,monospace;
font-size:clamp(22px,7vw,36px);font-weight:700;
letter-spacing:5px;text-align:center;text-transform:uppercase;
color:var(â€“cyan);text-shadow:0 0 20px rgba(37,244,238,.4);
padding:14px 10px;background:var(â€“surface2);border-radius:12px;margin:8px 0 14px;
}

/* â•â•â• HINT LIST â•â•â• */
.hints-list{display:flex;flex-direction:column;gap:5px;width:100%;}
.hint-item{
display:flex;align-items:flex-start;gap:8px;
padding:9px 12px;background:var(â€“surface2);
border-radius:10px;border:1px solid var(â€“border);
animation:fadeUp .3s ease;
}
.hint-num{
font-family:â€˜Space Monoâ€™,monospace;font-size:9px;color:var(â€“cyan);
background:rgba(37,244,238,.1);padding:2px 6px;border-radius:4px;
letter-spacing:1px;flex-shrink:0;margin-top:2px;font-weight:700;
}
.hint-txt{font-size:13px;line-height:1.5;flex:1;font-weight:700;}
.hint-by{font-size:10px;color:var(â€“text3);margin-top:2px;font-weight:400;}

.no-hint{
padding:20px;text-align:center;font-size:11px;color:var(â€“text3);
font-weight:700;letter-spacing:2px;
border:1.5px dashed var(â€“border);border-radius:10px;
}

/* â•â•â• GUESS FEED â•â•â• */
.guess-feed{display:flex;flex-direction:column;gap:5px;max-height:180px;overflow-y:auto;}
.guess-item{
display:flex;align-items:center;justify-content:space-between;
padding:8px 12px;background:var(â€“surface2);border-radius:10px;
border:1.5px solid var(â€“border);animation:fadeUp .25s ease;
font-size:13px;
}
.guess-item.correct{border-color:var(â€“green);background:rgba(29,185,84,.07);}
.guess-item.close{border-color:var(â€“gold);background:rgba(255,215,0,.06);}
.gw{font-family:â€˜Space Monoâ€™,monospace;font-size:11px;letter-spacing:1px;font-weight:700;}
.gn{font-weight:800;font-size:12px;}
.gr{font-size:16px;}

/* â•â•â• INPUT GUESS â•â•â• */
.guess-input-row{display:flex;gap:8px;width:100%;align-items:stretch;}
.inp-guess{
flex:1;padding:14px 16px;
font-family:â€˜Space Monoâ€™,monospace;font-size:18px;font-weight:700;letter-spacing:3px;
text-align:center;text-transform:uppercase;
background:var(â€“surface2);border:2px solid var(â€“border);border-radius:14px;
color:var(â€“text);outline:none;transition:all .2s;
}
.inp-guess:focus{border-color:var(â€“gold);box-shadow:0 0 0 4px rgba(255,215,0,.1);}
.inp-guess::placeholder{color:var(â€“text3);font-size:12px;letter-spacing:2px;}

/* â•â•â• FOUND BANNER â•â•â• */
.found-banner{
display:none;padding:14px;border-radius:12px;text-align:center;
background:rgba(29,185,84,.1);border:2px solid var(â€“green);
font-weight:900;font-size:14px;color:var(â€“green);letter-spacing:.5px;
}
.found-banner.show{display:block;animation:fadeUp .4s ease;}

/* â•â•â• OVERLAY RÃ‰SULTAT MANCHE â•â•â• */
#result-overlay{
position:fixed;inset:0;z-index:500;
display:none;align-items:flex-end;justify-content:center;
padding:0 14px 20px;
}
#result-overlay.show{display:flex;}
#result-overlay::before{
content:â€™â€™;position:fixed;inset:0;background:var(â€“overlay);backdrop-filter:blur(6px);z-index:-1;
}
.result-sheet{
background:var(â€“surface);border:1.5px solid var(â€“border);
border-radius:24px 24px 20px 20px;
padding:24px 20px 20px;width:100%;max-width:420px;
animation:slideSheet .45s cubic-bezier(.34,1.2,.64,1);
}
@keyframes slideSheet{from{transform:translateY(100%)}to{transform:translateY(0)}}
.sheet-handle{width:40px;height:4px;background:var(â€“border);border-radius:4px;margin:0 auto 16px;}

/* â•â•â• SCOREBOARD â•â•â• */
.score-row{
display:flex;align-items:center;gap:12px;
padding:12px 14px;background:var(â€“surface2);
border-radius:12px;border:1.5px solid var(â€“border);margin-bottom:6px;
}
.s-rank{font-size:20px;width:28px;text-align:center;}
.s-name{font-weight:800;flex:1;font-size:13px;}
.s-pts{font-family:â€˜Space Monoâ€™,monospace;font-size:15px;font-weight:700;color:var(â€“gold);}
.s-delta{font-family:â€˜Space Monoâ€™,monospace;font-size:10px;color:var(â€“green);margin-left:4px;}

/* â•â•â• TOAST â•â•â• */
#toast{
position:fixed;bottom:20px;left:50%;transform:translateX(-50%) translateY(80px);
background:var(â€“surface);border:1.5px solid var(â€“border);
border-radius:50px;padding:11px 22px;
font-weight:800;font-size:13px;z-index:9999;
transition:transform .35s cubic-bezier(.34,1.56,.64,1);
white-space:nowrap;max-width:90vw;text-align:center;
pointer-events:none;color:var(â€“text);
box-shadow:0 8px 32px rgba(0,0,0,.3);
}
#toast.up{transform:translateX(-50%) translateY(0);}
#toast.ok{border-color:var(â€“green);}
#toast.er{border-color:var(â€“pink);}
#toast.if{border-color:var(â€“cyan);}
#toast.gd{border-color:var(â€“gold);}

/* â•â•â• UTILS â•â•â• */
.col{display:flex;flex-direction:column;gap:10px;width:100%;}
.row{display:flex;gap:8px;align-items:center;}
.tc{text-align:center;} .w100{width:100%;}
.mt8{margin-top:8px;} .mt12{margin-top:12px;}
.ttl{font-weight:900;font-size:18px;} .sm{font-size:13px;font-weight:700;}
.muted{color:var(â€“text2);} .xs{font-size:11px;}
.shk{animation:shk .35s ease}
@keyframes shk{0%,100%{transform:translateX(0)}25%{transform:translateX(-8px)}75%{transform:translateX(8px)}}
@keyframes confY{to{transform:translateY(110vh) rotate(720deg);opacity:0}}

@media(max-width:360px){
.blank{width:25px;height:30px;font-size:15px;}
.master-word-display{font-size:18px;letter-spacing:3px;}
}
</style>

</head>
<body>

<div class="blob blob1"></div>
<div class="blob blob2"></div>

<!-- TOPBAR -->

<div class="topbar">
<button class="icon-btn" id="back-btn">â† Quitter</button>
<div class="topbar-logo">ğŸ”® MOT MYSTÃˆRE</div>
<div class="topbar-right">
<button class="icon-btn" id="theme-btn">â˜€ï¸ Clair</button>
</div>
</div>

<div id="toast"></div>

<!-- RÃ‰SULTAT MANCHE OVERLAY -->

<div id="result-overlay">
<div class="result-sheet">
<div class="sheet-handle"></div>
<div style="text-align:center;margin-bottom:14px;">
<div style="font-size:44px;margin-bottom:4px;" id="ro-icon">ğŸ‰</div>
<div style="font-family:'Space Mono',monospace;font-size:18px;font-weight:700;letter-spacing:2px;" id="ro-title"></div>
<div style="font-size:12px;color:var(--text2);margin-top:4px;" id="ro-word"></div>
</div>
<div id="ro-scores" style="margin-bottom:14px;"></div>
<button class="btn b-pink" id="ro-next" style="display:none;">MANCHE SUIVANTE â†’</button>
<div id="ro-wait" style="display:none;text-align:center;font-size:11px;color:var(--text3);font-weight:700;letter-spacing:2px;padding:8px;">EN ATTENTE DE L'HÃ”TE...</div>
</div>
</div>

<div class="app" style="padding-top:70px;">

<!-- â•â• HOME â•â• -->

<div id="s-home" class="sc on">
<div class="logo-zone">
<span class="logo-emoji">ğŸ”®</span>
<div class="logo-name">Mot MystÃ¨re</div>
<div class="logo-tag">// Indices Â· DÃ©duction Â· Multijoueur //</div>
</div>
<div class="col" style="max-width:320px;gap:10px;margin-top:8px;">
<button class="btn b-pink" id="btn-go-create">ğŸ¯ CrÃ©er une partie</button>
<button class="btn b-cyan" id="btn-go-join">ğŸš€ Rejoindre une partie</button>
</div>
<div class="xs muted tc mt8" style="font-weight:700;">2 Ã  8 joueurs Â· En ligne Â· 500+ mots</div>
</div>

<!-- â•â• CREATE â•â• -->

<div id="s-create" class="sc">
<div class="logo-zone" style="padding:0;">
<span class="logo-emoji" style="font-size:38px;animation:none;">ğŸ¯</span>
<div class="logo-name" style="font-size:24px;">Nouvelle partie</div>
</div>
<div class="card card-pink w100">
<div class="col">
<div>
<span class="slbl">Ton pseudo</span>
<input class="inp" id="c-name" type="text" placeholder="Ex: Shadow42" maxlength="14" autocomplete="off">
</div>
<div>
<span class="slbl">Nombre de manches</span>
<select class="sel" id="c-rounds">
<option value="3">3 manches â€” rapide âš¡</option>
<option value="5" selected>5 manches â€” classique ğŸ¯</option>
<option value="8">8 manches â€” long ğŸ”¥</option>
<option value="12">12 manches â€” lÃ©gendaire ğŸ†</option>
</select>
</div>
<div>
<span class="slbl">DifficultÃ©</span>
<div class="diff-row">
<div class="dtile de on" data-diff="facile"><span class="di">ğŸ˜Š</span><span class="dn" style="color:var(--green)">FACILE</span></div>
<div class="dtile dm" data-diff="moyen"><span class="di">ğŸ”¥</span><span class="dn" style="color:var(--gold)">MOYEN</span></div>
<div class="dtile dh" data-diff="difficile"><span class="di">ğŸ’€</span><span class="dn" style="color:var(--pink)">DIFFICILE</span></div>
</div>
</div>
<div>
<span class="slbl">CatÃ©gories</span>
<div class="chips" id="chips-wrap">
<div class="chip on" data-cat="tous">ğŸŒ TOUS</div>
<div class="chip" data-cat="animal">ğŸ¾ ANIMAUX</div>
<div class="chip" data-cat="pays">ğŸŒ PAYS</div>
<div class="chip" data-cat="sport">âš½ SPORT</div>
<div class="chip" data-cat="objet">ğŸ”§ OBJETS</div>
<div class="chip" data-cat="metier">ğŸ’¼ MÃ‰TIERS</div>
<div class="chip" data-cat="nature">ğŸŒ¿ NATURE</div>
<div class="chip" data-cat="food">ğŸ• FOOD</div>
<div class="chip" data-cat="science">ğŸ”¬ SCIENCE</div>
</div>
</div>
<div>
<span class="slbl">Temps par manche</span>
<select class="sel" id="c-timer">
<option value="60">60 secondes</option>
<option value="90" selected>90 secondes</option>
<option value="120">2 minutes</option>
</select>
</div>
<button class="btn b-pink" id="btn-create">CRÃ‰ER âœ¨</button>
<button class="btn b-ghost b-sm" id="btn-create-back">â† Retour</button>
</div>
</div>
</div>

<!-- â•â• JOIN â•â• -->

<div id="s-join" class="sc">
<div class="logo-zone" style="padding:0;">
<span class="logo-emoji" style="font-size:38px;animation:none;">ğŸš€</span>
<div class="logo-name" style="font-size:24px;">Rejoindre</div>
</div>
<div class="card card-cyan w100">
<div class="col">
<div>
<span class="slbl">Ton pseudo</span>
<input class="inp" id="j-name" type="text" placeholder="Ex: Ninja99" maxlength="14" autocomplete="off">
</div>
<div>
<span class="slbl">Code de la partie</span>
<input class="inp-code" id="j-code" type="text" placeholder="XXXX" maxlength="4">
</div>
<button class="btn b-cyan" id="btn-join">REJOINDRE â†’</button>
<button class="btn b-ghost b-sm" id="btn-join-back">â† Retour</button>
</div>
</div>
</div>

<!-- â•â• LOBBY â•â• -->

<div id="s-lobby" class="sc">
<div class="tc w100">
<div style="font-family:'Space Mono',monospace;font-size:9px;color:var(--text3);letter-spacing:3px;font-weight:700;margin-bottom:6px;">CODE DE LA PARTIE</div>
<div class="codebox">
<span id="l-code" style="display:block;font-family:'Space Mono','Courier New',monospace;font-size:42px;font-weight:700;letter-spacing:12px;color:var(--gold);text-align:center;padding:4px 0;text-shadow:0 0 20px rgba(255,215,0,.4);">----</span>
<div class="copyhint" id="btn-copy">[ APPUYER POUR COPIER ]</div>
</div>
</div>
<div class="card w100">
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
<span class="slbl" style="margin:0;">JOUEURS</span>
<span id="l-status" style="font-family:'Space Mono',monospace;font-size:10px;color:var(--text3);font-weight:700;"></span>
</div>
<div class="plist" id="l-players"></div>
</div>
<div id="l-settings" style="font-family:'Space Mono',monospace;font-size:10px;color:var(--text3);text-align:center;line-height:2;font-weight:700;"></div>
<button class="btn b-gold w100" id="l-start" style="display:none;">âš¡ LANCER !</button>
<div id="l-hint" style="display:none;font-size:11px;color:var(--text3);text-align:center;font-weight:700;"></div>
</div>

<!-- â•â• GAME â•â• -->

<div id="s-game" class="sc" style="max-width:480px;gap:10px;width:100%;">

<!-- Header manche -->

<div style="display:flex;justify-content:space-between;align-items:center;width:100%;padding:0 2px;">
<div>
<div style="font-family:'Space Mono',monospace;font-size:9px;color:var(--text3);letter-spacing:2px;font-weight:700;">MANCHE</div>
<div id="g-round" style="font-family:'Space Mono',monospace;font-size:16px;font-weight:700;color:var(--text);">1/5</div>
</div>
<div style="display:flex;align-items:center;gap:10px;">
<div style="text-align:right;">
<div style="font-family:'Space Mono',monospace;font-size:9px;color:var(--text3);letter-spacing:1px;font-weight:700;">MAÃTRE</div>
<div id="g-master" style="font-family:'Space Mono',monospace;font-size:11px;color:var(--cyan);font-weight:700;">â€”</div>
</div>
<div class="timer-ring">
<svg width="44" height="44" viewBox="0 0 44 44">
<circle cx="22" cy="22" r="19" fill="none" stroke="var(--surface3)" stroke-width="3"/>
<circle id="timer-arc" cx="22" cy="22" r="19" fill="none" stroke="var(--cyan)" stroke-width="3" stroke-linecap="round"/>
</svg>
<span id="timer-txt">90</span>
</div>
</div>
</div>

<!-- Progress -->

<div class="prog-bar w100"><div class="prog-fill" id="g-prog" style="width:0%"></div></div>

<!-- VUE MAÃTRE ğŸ‘‘ -->

<div id="ph-master" style="display:none;width:100%;">
<div class="master-zone">
<div class="master-label">ğŸ‘‘ TU ES LE MAÃTRE â€” DONNE DES INDICES !</div>
<div class="master-word-display" id="master-word">...</div>
<div style="font-family:'Space Mono',monospace;font-size:10px;color:var(--text3);text-align:center;margin-bottom:12px;" id="master-cat">CatÃ©gorie : â€”</div>
<div>
<span class="slbl">Envoie un indice (sans le mot !)</span>
<div class="row w100" style="gap:8px;">
<input class="inp" id="hint-inp" type="text" placeholder="Ex: c'est un animal..." maxlength="80" style="flex:1;">
<button class="btn b-cyan b-sm" id="btn-hint" style="width:auto;white-space:nowrap;">ENVOYER</button>
</div>
</div>
<div class="hints-list mt8" id="hints-sent"></div>
</div>

```
<!-- Le maÃ®tre voit aussi les tentatives des autres -->
<div style="width:100%;margin-top:10px;">
<span class="slbl">TENTATIVES DES JOUEURS</span>
<div class="guess-feed" id="master-guesses">
<div class="no-hint">Personne n'a encore essayÃ©...</div>
</div>
</div>
```

</div>

<!-- VUE DEVINEUR ğŸ” -->

<div id="ph-guess" style="display:none;width:100%;">

```
<!-- Mot Ã  trouver -->
<div class="word-zone">
<div class="wz-meta">
<span class="pill pill-pink" id="g-cat">CatÃ©gorie</span>
<span class="pill pill-gold" id="g-pts">â­ 100pts</span>
</div>
<div class="blanks" id="g-blanks"></div>
<div class="word-meta-row" id="g-info"></div>
</div>

<!-- Indices reÃ§us -->
<div style="width:100%;">
<span class="slbl">INDICES DU MAÃTRE</span>
<div class="hints-list" id="g-hints">
<div class="no-hint">En attente du premier indice...</div>
</div>
</div>

<!-- Tentatives -->
<div style="width:100%;">
<span class="slbl">TENTATIVES</span>
<div class="guess-feed" id="g-guesses">
<div class="no-hint">Sois le premier Ã  essayer !</div>
</div>
</div>

<!-- Input -->
<div id="guess-zone" style="width:100%;">
<div class="guess-input-row">
<input class="inp-guess" id="guess-inp" type="text" placeholder="TON MOT..." maxlength="32">
<button class="btn b-gold b-sm" id="btn-guess" style="width:auto;min-width:80px;border-radius:14px;">DEVINER</button>
</div>
</div>
<div class="found-banner" id="found-banner">âœ… BRAVO ! Tu as trouvÃ© ! En attente des autres...</div>
```

</div>

</div>

<!-- â•â• END â•â• -->

<div id="s-end" class="sc">
<div style="text-align:center;margin-bottom:8px;">
<div style="font-size:64px;">ğŸ†</div>
<div style="font-family:'Space Mono',monospace;font-size:24px;font-weight:700;letter-spacing:2px;background:linear-gradient(135deg,var(--gold),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-top:4px;">PARTIE TERMINÃ‰E</div>
<div style="font-size:13px;color:var(--text2);margin-top:6px;font-weight:700;" id="e-winner"></div>
</div>
<div id="e-scores" style="width:100%;"></div>
<div class="row w100 mt12" style="flex-wrap:wrap;justify-content:center;gap:8px;">
<button class="btn b-gold" id="btn-replay" style="width:auto;padding:14px 28px;">ğŸ”„ REJOUER</button>
<button class="btn b-ghost" id="btn-home-end" style="width:auto;padding:14px 28px;">ğŸ  ACCUEIL</button>
</div>
</div>

</div><!-- /app -->

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// THEME â€” FONCTIONNE AVANT TOUT LE RESTE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var isLight = localStorage.getItem('mm_theme') === 'light';
function applyTheme(l) {
isLight = l;
document.documentElement.setAttribute('data-theme', l ? 'light' : 'dark');
var btn = document.getElementById('theme-btn');
if (btn) btn.innerHTML = l ? 'ğŸŒ™ Sombre' : 'â˜€ï¸ Clair';
localStorage.setItem('mm_theme', l ? 'light' : 'dark');
}
applyTheme(isLight);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIREBASE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var db = null, fbReady = false;
(function() {
var s1 = document.createElement('script');
s1.src = 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js';
s1.async = true;
s1.onload = function() {
var s2 = document.createElement('script');
s2.src = 'https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js';
s2.async = true;
s2.onload = function() {
try {
if (!firebase.apps.length) {
firebase.initializeApp({
apiKey: "AIzaSyAWW-rnF1dqdCc5kCuI-d9dTSMrBJCrSb0",
authDomain: "test-a5848.firebaseapp.com",
databaseURL: "https://test-a5848-default-rtdb.europe-west1.firebasedatabase.app",
projectId: "test-a5848",
storageBucket: "test-a5848.firebasestorage.app",
messagingSenderId: "704331097703",
appId: "1:704331097703:web:613a8f735e863a312316c2"
});
}
db = firebase.database();
fbReady = true;
} catch(e) { console.warn('FB', e); }
};
document.head.appendChild(s2);
};
document.head.appendChild(s1);
})();
function whenFB(fn) { if (fbReady) fn(); else setTimeout(function() { whenFB(fn); }, 80); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MOTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var WORDS = {
animal: {
facile: ['CHAT','CHIEN','LAPIN','VACHE','MOUTON','COCHON','CHEVAL','POULE','CANARD','SINGE','OURS','LOUP','RENARD','SERPENT','GRENOUILLE','TIGRE','LION','ELEPHANT','GIRAFE','ZEBRE','DAUPHIN','PERROQUET'],
moyen: ['CAMELEON','CROCODILE','HIPPOPOTAME','FLAMANT','MANCHOT','TATOU','CAPYBARA','OKAPI','TAPIR','AXOLOTL','OUISTITI','PANGOLIN','NARVAL','DUGONG','PIRANHA','JAGUAR','GUEPARD','PANDA'],
difficile: ['COELACANTHE','NAUTILE','TARDIGRADE','BINTURONG','FOSSA','QUOKKA','XENARTHRE','MONOTREME','PLATHELMINTHE','CNIDAIRE','ECHINODERM']
},
pays: {
facile: ['FRANCE','ESPAGNE','ITALIE','PORTUGAL','BELGIQUE','SUISSE','ALLEMAGNE','JAPON','CHINE','CANADA','MEXIQUE','BRESIL','MAROC','ALGERIE','TUNISIE','EGYPTE','RUSSIE','INDE'],
moyen: ['MOZAMBIQUE','EQUATEUR','BOTSWANA','ALBANIE','SLOVENIE','MALAISIE','CAMBODGE','URUGUAY','PARAGUAY','NICARAGUA','GEORGIE','ARMENIE','AZERBAIDJAN','MONGOLIE','ETHIOPIE'],
difficile: ['LIECHTENSTEIN','TURKMENISTAN','TADJIKISTAN','MICRONESIA','VANUATU','KIRIBATI','NAURU','TUVALU','PALAU','DJIBOUTI','COMORES','SURINAME','BHOUTAN']
},
sport: {
facile: ['FOOTBALL','TENNIS','NATATION','BOXE','RUGBY','GOLF','BASKET','VOLLEY','JUDO','KARATE','VELO','COURSE','HANDBALL','PATINAGE','SKI','SURF','BASEBALL'],
moyen: ['BADMINTON','ESCRIME','AVIRON','TRIATLON','PENTATHLON','BOBSLEIGH','CURLING','WATERPOLO','SUMO','KENDO','LACROSSE','POLO','CROQUET','SOFTBALL','SQUASH'],
difficile: ['SEPAKTAKRAW','KABADDI','BOSSABALL','BUZKASHI','PESAPALLO','PANKRATION','MOTOBALL','HORNUSSEN','SLAMBALL','KRONUM']
},
objet: {
facile: ['TABLE','CHAISE','LAMPE','STYLO','LIVRE','FENETRE','MIROIR','TELEPHONE','ORDINATEUR','CISEAUX','PARAPLUIE','HORLOGE','BOUGIE','COUSSIN','TABLEAU','LUNETTES'],
moyen: ['THERMOMETRE','MICROSCOPE','TELESCOPE','BOUSSOLE','GYROSCOPE','KALEIDOSCOPE','SEXTANT','ASTROLABE','METRONOME','STETHOSCOPE','PANTOGRAPHE','ALAMBIC','SOUFFLET'],
difficile: ['OCTANT','HYGROMETRE','PYRANOMETRE','BOLOMETRE','SPECTROSCOPE','REFRACTOMETRE','CRYOSTAT','MICROTOME','GALVANOMETRE']
},
metier: {
facile: ['DOCTEUR','POMPIER','PILOTE','CUISINIER','PROFESSEUR','ARCHITECTE','AVOCAT','PLOMBIER','COIFFEUR','ACTEUR','CHANTEUR','PHOTOGRAPHE','JARDINIER','BOUCHER','BOULANGER'],
moyen: ['OSTEOPATHE','SOMMELIER','LUTHIER','TAXIDERMISTE','CARTOGRAPHE','ORFEVRE','CALLIGRAPHE','BOTTIER','CHAPELIER','TONNELIER','SAGEFEMME','CHIROPRACTEUR'],
difficile: ['THANATOLOGUE','NOSOLOGUE','CETOLOGUE','POMOLOGUE','HERPETOLOGUE','MALACOLOGISTE','PALEOBOTANISTE','ARACHNOLOGUE','GLACIOLOGUE']
},
nature: {
facile: ['MONTAGNE','RIVIERE','FORET','DESERT','OCEAN','VOLCAN','VALLEE','PLAGE','GROTTE','PRAIRIE','COLLINE','GLACIER','ETANG','MARAIS','FJORD'],
moyen: ['STALAGMITE','ESTUAIRE','MANGROVE','ATOLL','SAVANE','TOUNDRA','TAIGA','STEPPE','MORAINE','SOLFATARE','GEYSER','LAGUNE','TOURBIERE'],
difficile: ['KARST','LOESS','DRUMLINS','YARDANG','PENEPLAINE','HORST','GRABEN','OPHIOLITE','BATHOLITE','GRANULITE','ECLOGITE']
},
food: {
facile: ['PIZZA','SUSHI','BURGER','CREPE','SALADE','SOUPE','PASTA','FROMAGE','CHOCOLAT','GLACE','GATEAU','POISSON','POULET','STEAK','TARTE','QUICHE'],
moyen: ['BOUILLABAISSE','COUSCOUS','PAELLA','RACLETTE','BRUSCHETTA','TIRAMISU','GUACAMOLE','TABOULEH','RATATOUILLE','CASSOULET','CEVICHE','GOULASH','TAGINE','KIMCHI'],
difficile: ['BRIGADEIRO','JALEBI','BAKLAVA','INJERA','LUTEFISK','HAGGIS','SURSTROMING','NATTO','VEGEMITE','CEVAPI','KHINKALI']
},
science: {
facile: ['ATOME','ELECTRON','PROTON','MOLECULE','CELLULE','ADN','GENE','PROTEINE','ENZYME','VIRUS','BACTERIE','PLASMA','NEUTRON','ISOTOPE','LASER'],
moyen: ['PHOTOSYNTHESE','MITOCHONDRIE','CHROMOSOME','RIBOSOMES','CHLOROPHYLLE','CATALYSE','OSMOSE','DIFFRACTION','RESONANCE','THERMOLYSE','ELECTROLYSE'],
difficile: ['BIOLUMINESCENCE','PIEZOELECTRICITE','SUPERCONDUCTEUR','BREMSSTRAHLUNG','RENORMALISATION','DECOHERENCE','SPINTRONIC','HOLOMORPHIE']
},
tous: {
facile: ['SOLEIL','LUNE','ETOILE','MAISON','VOITURE','FLEUR','ARBRE','ENFANT','AMOUR','JOIE','REVE','NUIT','JARDIN','BATEAU','AVION'],
moyen: ['AVENTURE','MYSTERE','LIBERTE','SAGESSE','COURAGE','JUSTICE','BONHEUR','LUMIERE','SILENCE','HARMONIE','PATIENCE','ENERGIE','BEAUTE'],
difficile: ['SERENDIPITE','INEFFABLE','EPHEMERE','PALIMPSESTE','QUIDDITE','SYNCRETISME','ESCHATOLOGIE','LOGOMACIE']
}
};

function getWord(cats, diff) {
var pool = [];
(cats || ['tous']).forEach(function(cat) {
var c = WORDS[cat];
if (c && c[diff]) pool = pool.concat(c[diff]);
});
if (!pool.length) pool = WORDS.tous[diff] || WORDS.tous.facile;
return pool[Math.floor(Math.random() * pool.length)];
}

function findCat(word) {
for (var c in WORDS) for (var d in WORDS[c]) if (WORDS[c][d].indexOf(word) !== -1) return c;
return 'tous';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var COLORS = ['#fe2c55','#25f4ee','#ffd700','#a855f7','#1db954','#ff8c00','#3d7fff','#ff6b6b','#74b9ff'];
var AVATARS = ['ğŸ¯','ğŸ¦Š','ğŸ’€','ğŸ¤–','ğŸ‘¾','ğŸŒŸ','ğŸ”¥','âš¡','ğŸ’'];
var myId = sessionStorage.getItem('mm2_uid') || Math.random().toString(36).slice(2, 11);
sessionStorage.setItem('mm2_uid', myId);
var myName = '', myColor = '', myAvatar = '';
var roomCode = '', roomRef = null, gbListener = null;
var selDiff = 'facile', selCats = ['tous'];
var timerInterval = null, timerMax = 90, timerLeft = 0;
var overlayShown = false;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAV
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function go(id) {
document.querySelectorAll('.sc').forEach(function(s) { s.classList.remove('on'); });
document.getElementById(id).classList.add('on');
var inGame = ['s-create','s-join','s-lobby','s-game','s-end'].includes(id);
document.getElementById('back-btn').classList.toggle('vis', inGame);
}
function goBack() { leaveRoom(); go('s-home'); }
function goHome() { leaveRoom(); go('s-home'); }
function leaveRoom() {
stopTimer();
if (gbListener) { gbListener(); gbListener = null; }
roomRef = null; roomCode = '';
overlayShown = false;
document.getElementById('result-overlay').classList.remove('show');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UTILS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function genCode() {
var c = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
return Array.from({length:4}, function() { return c[Math.floor(Math.random()*c.length)]; }).join('');
}
var toastT;
function toast(msg, type, dur) {
dur = dur || 2600;
var t = document.getElementById('toast');
t.textContent = msg; t.className = 'up ' + (type || 'if');
clearTimeout(toastT); toastT = setTimeout(function() { t.classList.remove('up'); }, dur);
}
function shk(id) { var e = document.getElementById(id); if (!e) return; e.classList.add('shk'); setTimeout(function(){e.classList.remove('shk');},400); }
function copyCode() {
if (navigator.clipboard) navigator.clipboard.writeText(roomCode).then(function(){ toast('CODE COPIÃ‰ !','ok'); }).catch(function(){ toast('CODE: '+roomCode,'if'); });
else toast('CODE: '+roomCode,'if');
}
function confetti() {
['#fe2c55','#25f4ee','#ffd700','#a855f7','#1db954'].forEach(function(col) {
for (var i=0; i<15; i++) {
var el = document.createElement('div');
var sz = 5+Math.random()*8;
el.style.cssText='position:fixed;left:'+Math.random()*100+'vw;top:-20px;width:'+sz+'px;height:'+sz+'px;background:'+col+';border-radius:'+(Math.random()>.5?'50%':'2px')+';animation:confY '+(2+Math.random()*3)+'s '+(Math.random()*1.5)+'s linear forwards;z-index:9999;pointer-events:none;';
document.body.appendChild(el); setTimeout(function(){el.remove();},5500);
}
});
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TIMER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function startTimer(sec, onEnd) {
clearInterval(timerInterval);
timerLeft = sec; timerMax = sec;
updateTimerUI(timerLeft);
timerInterval = setInterval(function() {
timerLeft--;
updateTimerUI(timerLeft);
if (timerLeft <= 0) { clearInterval(timerInterval); if (onEnd) onEnd(); }
}, 1000);
}
function stopTimer() { clearInterval(timerInterval); }
function updateTimerUI(t) {
var txt = document.getElementById('timer-txt');
var arc = document.getElementById('timer-arc');
if (!txt || !arc) return;
txt.textContent = t;
var offset = 120 * (1 - t/timerMax);
arc.style.strokeDashoffset = offset;
var col = t > timerMax*.5 ? 'var(--cyan)' : t > timerMax*.25 ? 'var(--gold)' : 'var(--pink)';
arc.style.stroke = col; txt.style.color = col;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CRÃ‰ER PARTIE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function createGame() {
var name = document.getElementById('c-name').value.trim();
if (!name) { toast('ENTRE TON PSEUDO !','er'); shk('c-name'); return; }
if (!selCats.length) { toast('CHOISIS UNE CATÃ‰GORIE !','er'); return; }
var rounds = parseInt(document.getElementById('c-rounds').value);
var timer = parseInt(document.getElementById('c-timer').value);
var code = genCode();
myName = name; myColor = COLORS[0]; myAvatar = AVATARS[0]; roomCode = code;
var data = {
code:code, hostId:myId, status:'lobby',
rounds:rounds, timer:timer, difficulty:selDiff, categories:selCats,
currentRound:0, masterIdx:0,
currentWord:null, currentCat:null,
hints:[], guesses:{}, scores:{}, roundWinners:{},
players:{}, createdAt:Date.now(), updatedAt:Date.now()
};
data.players[myId] = {id:myId,name:name,color:myColor,avatar:myAvatar,joinedAt:Date.now()};
data.scores[myId] = 0;
whenFB(function() {
db.ref('mm_games/'+code).set(data).then(function() {
attachListener(code); go('s-lobby');
toast('CRÃ‰Ã‰ ! CODE: '+code,'ok',4000);
}).catch(function(e){ toast('ERREUR: '+e.message,'er'); });
});
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// REJOINDRE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function joinGame() {
var name = document.getElementById('j-name').value.trim();
var code = document.getElementById('j-code').value.trim().toUpperCase();
if (!name) { toast('ENTRE TON PSEUDO !','er'); shk('j-name'); return; }
if (code.length !== 4) { toast('CODE Ã€ 4 CARACTÃˆRES !','er'); shk('j-code'); return; }
whenFB(function() {
db.ref('mm_games/'+code).get().then(function(snap) {
if (!snap.exists()) { toast('CODE INVALIDE !','er'); shk('j-code'); return; }
var game = snap.val();
if (game.status !== 'lobby') { toast('PARTIE DÃ‰JÃ€ EN COURS !','er'); return; }
var cnt = Object.keys(game.players||{}).length;
if (cnt >= 8) { toast('PARTIE PLEINE !','er'); return; }
var idx = cnt % COLORS.length;
myName = name; myColor = COLORS[idx]; myAvatar = AVATARS[idx]; roomCode = code;
var upd = {};
upd['players/'+myId] = {id:myId,name:name,color:myColor,avatar:myAvatar,joinedAt:Date.now()};
upd['scores/'+myId] = 0;
upd['updatedAt'] = Date.now();
db.ref('mm_games/'+code).update(upd).then(function() {
attachListener(code); go('s-lobby');
toast('BIENVENUE '+name.toUpperCase()+'!','ok');
});
}).catch(function(e){ toast('ERREUR: '+e.message,'er'); });
});
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LISTENER FIREBASE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function attachListener(code) {
if (gbListener) gbListener();
roomRef = db.ref('mm_games/'+code);
roomRef.on('value', function(snap) {
if (!snap.exists()) return;
var game = snap.val();
var curScreen = (document.querySelector('.sc.on')||{}).id || '';
if (game.status === 'lobby') { renderLobby(game); }
else if (game.status === 'playing') { if (curScreen==='s-lobby') go('s-game'); renderGame(game); }
else if (game.status === 'round_end') { if (curScreen==='s-lobby') go('s-game'); renderGame(game); showRoundEnd(game); }
else if (game.status === 'end') { renderEndGame(game); }
});
gbListener = function() { roomRef.off('value'); };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LOBBY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderLobby(game) {
document.getElementById('l-code').textContent = game.code;
var players = Object.values(game.players||{}).sort(function(a,b){return a.joinedAt-b.joinedAt;});
var listEl = document.getElementById('l-players'); listEl.innerHTML = '';
players.forEach(function(p) {
var isMe = p.id === myId;
var isHost = p.id === game.hostId;
var div = document.createElement('div');
div.className = 'prow' + (isMe?' me':'') + (isHost?' host':'');
div.innerHTML =
'<div class="pav" style="background:'+p.color+'22;color:'+p.color+'">'+p.avatar+'</div>'+
'<div class="pnm">'+p.name+'</div>'+
(isHost?'<span class="pill pill-cyan">HÃ”TE</span>':'')+
(isMe ?'<span class="pill pill-pink">MOI</span>':'')+
'<div class="pscore">'+(game.scores&&game.scores[p.id]||0)+'pts</div>';
listEl.appendChild(div);
});
var cnt = players.length;
document.getElementById('l-status').textContent = cnt+'/8';
var catN = {tous:'TOUS',animal:'ANIMAUX',pays:'PAYS',sport:'SPORT',objet:'OBJETS',metier:'MÃ‰TIERS',nature:'NATURE',food:'FOOD',science:'SCIENCE'};
document.getElementById('l-settings').innerHTML =
'<strong style="color:var(--text)">'+game.rounds+' MANCHES</strong> Â· '+
'<span style="color:var(--gold)">'+game.difficulty.toUpperCase()+'</span> Â· '+
(game.categories||['tous']).map(function(c){return catN[c]||c.toUpperCase();}).join(' Â· ')+
' Â· '+game.timer+'s';
var isHost = game.hostId === myId;
var canStart = cnt >= 2;
document.getElementById('l-start').style.display = (isHost && canStart) ? 'flex' : 'none';
var hint = document.getElementById('l-hint');
if (!canStart) { hint.style.display='block'; hint.textContent='Il faut au moins 2 joueurs !'; }
else if (!isHost) { hint.style.display='block'; hint.textContent="L'hÃ´te va lancer..."; }
else { hint.style.display='none'; }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LANCER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function startGame() {
whenFB(function() {
db.ref('mm_games/'+roomCode).get().then(function(snap) {
var game = snap.val(); if (!game) return;
var pids = Object.keys(game.players).sort(function(a,b){return game.players[a].joinedAt-game.players[b].joinedAt;});
if (pids.length < 2) { toast('IL FAUT 2 JOUEURS !','er'); return; }
launchRound(game, pids, 0, 1);
});
});
}

function launchRound(game, pids, masterIdx, roundNum) {
var masterId = pids[masterIdx % pids.length];
var word = getWord(game.categories, game.difficulty);
var cat = findCat(word);
// Tous les joueurs sauf le maÃ®tre sont devineurs
var initGuesses = {};
pids.forEach(function(pid) { if (pid !== masterId) initGuesses[pid] = null; });
overlayShown = false;
db.ref('mm_games/'+roomCode).update({
status:'playing',
currentRound:roundNum,
masterIdx:masterIdx,
masterId:masterId,
currentWord:word,
currentCat:cat,
hints:[],
guesses:initGuesses,
roundWinners:{},
roundStart:Date.now(),
updatedAt:Date.now()
});
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDU JEU â€” appelÃ© Ã  chaque update Firebase
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderGame(game) {
if (game.status !== 'playing' && game.status !== 'round_end') return;
stopTimer();

var isMaster = game.masterId === myId;
var isHost = game.hostId === myId;

// Header
document.getElementById('g-round').textContent = game.currentRound+'/'+game.rounds;
document.getElementById('g-master').textContent = (game.players&&game.players[game.masterId]?game.players[game.masterId].name:'?').toUpperCase();
document.getElementById('g-prog').style.width = ((game.currentRound-1)/game.rounds*100)+'%';

document.getElementById('ph-master').style.display = isMaster ? 'block' : 'none';
document.getElementById('ph-guess').style.display = isMaster ? 'none' : 'block';

if (game.status === 'playing') {
var elapsed = Math.floor((Date.now()-game.roundStart)/1000);
var remaining = Math.max(0, game.timer - elapsed);
if (remaining > 0) {
startTimer(remaining, function() {
if (isHost) endRound(game, false);
});
}
if (isMaster) renderMasterView(game);
else renderGuessView(game);
} else {
// round_end â€” juste rafraÃ®chir les tentatives
if (isMaster) renderGuessesOnly('master-guesses', game);
else renderGuessesOnly('g-guesses', game);
}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VUE MAÃTRE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderMasterView(game) {
document.getElementById('master-word').textContent = game.currentWord || '...';
document.getElementById('master-cat').textContent = 'CatÃ©gorie : '+(game.currentCat||'?').toUpperCase();
// Indices envoyÃ©s
var sentEl = document.getElementById('hints-sent'); sentEl.innerHTML = '';
(game.hints||[]).forEach(function(h, i) {
var d = document.createElement('div'); d.className = 'hint-item';
d.innerHTML = '<span class="hint-num">#'+(i+1)+'</span><div class="hint-txt">'+h.text+'</div>';
sentEl.appendChild(d);
});
renderGuessesOnly('master-guesses', game);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VUE DEVINEURS â€” les DEUX joueurs devinent !
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderGuessView(game) {
var word = game.currentWord || '';

// Blancs avec lettres rÃ©vÃ©lÃ©es progressivement
var blanksEl = document.getElementById('g-blanks'); blanksEl.innerHTML = '';
var hints = game.hints || [];
var revealed = new Set();
if (hints.length >= 2) {
var n = Math.floor(hints.length / 2);
for (var i=0; i<Math.min(n, word.length-1); i++) revealed.add(i);
}
for (var i=0; i<word.length; i++) {
var sp = document.createElement('span');
if (word[i] === ' ') { sp.className='blank space'; }
else {
sp.className = 'blank' + (revealed.has(i) ? ' lit' : '');
sp.textContent = revealed.has(i) ? word[i] : '';
}
blanksEl.appendChild(sp);
}
var realLen = word.replace(/ /g,'').length;
document.getElementById('g-info').textContent = realLen+' LETTRE'+(realLen>1?'S':'')+(word.includes(' ')?' Â· PLUSIEURS MOTS':'');

var pts = Math.max(10, 100 - (hints.length*10));
document.getElementById('g-pts').textContent = 'â­ '+pts+'pts';
document.getElementById('g-cat').textContent = (game.currentCat||'?').toUpperCase();

// Indices
var hintsEl = document.getElementById('g-hints'); hintsEl.innerHTML = '';
if (!hints.length) {
hintsEl.innerHTML = '<div class="no-hint">En attente du premier indice...</div>';
} else {
hints.forEach(function(h, i) {
var d = document.createElement('div'); d.className = 'hint-item';
d.innerHTML = '<span class="hint-num">#'+(i+1)+'</span><div><div class="hint-txt">'+h.text+'</div><div class="hint-by">Par '+h.who+'</div></div>';
hintsEl.appendChild(d);
});
}

// Tentatives
renderGuessesOnly('g-guesses', game);

// Input â€” visible si pas encore trouvÃ©
var myGuess = game.guesses && game.guesses[myId];
var iFound = myGuess && (myGuess === true || myGuess.correct);
var guessZone = document.getElementById('guess-zone');
var banner = document.getElementById('found-banner');
guessZone.style.display = iFound ? 'none' : 'block';
banner.classList.toggle('show', iFound);
}

function renderGuessesOnly(feedId, game) {
var feed = document.getElementById(feedId); if (!feed) return;
feed.innerHTML = '';
var guesses = game.guesses || {};
var hasAny = false;
Object.entries(guesses).forEach(function(entry) {
var pid = entry[0], val = entry[1];
if (!val || val === true || typeof val !== 'object') return;
hasAny = true;
var p = game.players && game.players[pid];
var div = document.createElement('div');
div.className = 'guess-item' + (val.correct?' correct':val.close?' close':'');
div.innerHTML =
'<span class="gn" style="color:'+(p?p.color:'#fff')+'">'+(p?p.name:'?')+'</span>'+
'<span class="gw">'+val.word+'</span>'+
'<span class="gr">'+(val.correct?'âœ…':val.close?'ğŸŸ¡':'âŒ')+'</span>';
feed.appendChild(div);
});
if (!hasAny) feed.innerHTML = '<div class="no-hint">'+(feedId==='master-guesses'?'Personne n\'a encore essayÃ©...':'Sois le premier Ã  essayer !')+'</div>';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ENVOYER INDICE (MAÃTRE)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function sendHint() {
var inp = document.getElementById('hint-inp');
var txt = inp.value.trim();
if (!txt) { toast('Ã‰CRIS UN INDICE !','er'); shk('hint-inp'); return; }
whenFB(function() {
db.ref('mm_games/'+roomCode).get().then(function(snap) {
var game = snap.val(); if (!game) return;
var word = (game.currentWord||'').toLowerCase();
if (txt.toLowerCase().includes(word)) { toast('PAS LE DROIT DE DIRE LE MOT !','er'); shk('hint-inp'); return; }
var hints = game.hints || [];
hints.push({text:txt, who:myName, at:Date.now()});
db.ref('mm_games/'+roomCode).update({hints:hints, updatedAt:Date.now()});
inp.value = '';
toast('INDICE ENVOYÃ‰ !','ok');
});
});
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DEVINER (DEVINEURS â€” les 2 peuvent deviner)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function levenshtein(a, b) {
var m=a.length, n=b.length, dp=[];
for (var i=0;i<=m;i++){dp[i]=[i];for(var j=1;j<=n;j++)dp[i][j]=i===0?j:0;}
for (var j=1;j<=n;j++) dp[0][j]=j;
for (var i=1;i<=m;i++) for (var j=1;j<=n;j++) {
dp[i][j]=a[i-1]===b[j-1]?dp[i-1][j-1]:1+Math.min(dp[i-1][j],dp[i][j-1],dp[i-1][j-1]);
}
return dp[m][n];
}

function submitGuess() {
var inp = document.getElementById('guess-inp');
var word = inp.value.trim().toUpperCase();
if (!word) { toast('ENTRE UN MOT !','er'); shk('guess-inp'); return; }
inp.value = '';
whenFB(function() {
db.ref('mm_games/'+roomCode).get().then(function(snap) {
var game = snap.val(); if (!game || game.status!=='playing') return;
// VÃ©rifier si dÃ©jÃ  trouvÃ©
var existing = game.guesses && game.guesses[myId];
if (existing && existing.correct) { toast('TU AS DÃ‰JÃ€ TROUVÃ‰ !','if'); return; }

var target = (game.currentWord||'').toUpperCase();
var correct = (word === target);
var close = !correct && levenshtein(word, target) <= 2;
var pts = Math.max(10, 100 - ((game.hints||[]).length*10));

var upd = {};
upd['guesses/'+myId] = {word:word, correct:correct, close:close, at:Date.now()};
upd['updatedAt'] = Date.now();

if (correct) {
upd['scores/'+myId] = ((game.scores&&game.scores[myId])||0) + pts;
if (!(game.roundWinners&&game.roundWinners[myId]))
upd['roundWinners/'+myId] = {name:myName, pts:pts};
toast('ğŸ‰ BRAVO ! +'+pts+' POINTS !','gd', 3000);
} else if (close) {
toast('ğŸŸ¡ TOUT PRÃˆS !','if');
} else {
toast('âŒ RATÃ‰','er', 1500);
}

db.ref('mm_games/'+roomCode).update(upd).then(function() {
if (!correct) return;
// VÃ©rifier si tous les devineurs ont trouvÃ©
db.ref('mm_games/'+roomCode).get().then(function(snap2) {
var g2 = snap2.val(); if (!g2) return;
var pids = Object.keys(g2.players).filter(function(pid){ return pid !== g2.masterId; });
var allFound = pids.every(function(pid){ var g=g2.guesses&&g2.guesses[pid]; return g&&g.correct; });
if (allFound && g2.hostId === myId) endRound(g2, true);
});
});
});
});
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIN DE MANCHE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function endRound(game, allFound) {
stopTimer();
var upd = {status:'round_end', updatedAt:Date.now()};
// Bonus maÃ®tre
var winners = game.roundWinners || {};
if (Object.keys(winners).length > 0) {
var bonus = Object.keys(winners).length * 20;
upd['scores/'+game.masterId] = ((game.scores&&game.scores[game.masterId])||0) + bonus;
}
db.ref('mm_games/'+roomCode).update(upd);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// OVERLAY RÃ‰SULTAT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showRoundEnd(game) {
if (overlayShown) return;
overlayShown = true;
var overlay = document.getElementById('result-overlay');
overlay.classList.add('show');
var winners = game.roundWinners || {};
var hasWin = Object.keys(winners).length > 0;
document.getElementById('ro-icon').textContent = hasWin ? 'ğŸ‰' : 'â°';
document.getElementById('ro-title').textContent = hasWin ? 'MOT TROUVÃ‰ !' : 'TEMPS Ã‰COULÃ‰ !';
document.getElementById('ro-word').textContent = 'Le mot Ã©tait : ' + game.currentWord;
var scEl = document.getElementById('ro-scores'); scEl.innerHTML = '';
Object.values(winners).forEach(function(w) {
var d = document.createElement('div');
d.style.cssText='font-family:"Space Mono",monospace;font-size:13px;color:var(--green);margin:3px 0;font-weight:700;';
d.textContent = 'ğŸ… '+w.name+' +'+w.pts+'pts';
scEl.appendChild(d);
});
if (!hasWin) {
var d = document.createElement('div');
d.style.cssText='font-size:12px;color:var(--text2);font-weight:700;';
d.textContent = 'Personne n\'a trouvÃ© ce round...';
scEl.appendChild(d);
}
var isHost = game.hostId === myId;
var isLast = game.currentRound >= game.rounds;
document.getElementById('ro-next').style.display = isHost ? 'flex' : 'none';
document.getElementById('ro-wait').style.display = isHost ? 'none' : 'block';
document.getElementById('ro-next').textContent = isLast ? 'ğŸ† RÃ‰SULTATS FINAUX' : 'MANCHE SUIVANTE â†’';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MANCHE SUIVANTE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function nextRound() {
overlayShown = false;
document.getElementById('result-overlay').classList.remove('show');
whenFB(function() {
db.ref('mm_games/'+roomCode).get().then(function(snap) {
var game = snap.val(); if (!game || game.hostId!==myId) return;
if (game.currentRound >= game.rounds) {
db.ref('mm_games/'+roomCode).update({status:'end', updatedAt:Date.now()});
return;
}
var pids = Object.keys(game.players).sort(function(a,b){return game.players[a].joinedAt-game.players[b].joinedAt;});
launchRound(game, pids, (game.masterIdx+1)%pids.length, game.currentRound+1);
});
});
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIN DE PARTIE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderEndGame(game) {
stopTimer(); overlayShown=false;
document.getElementById('result-overlay').classList.remove('show');
go('s-end'); confetti();
var players = Object.values(game.players||{}).sort(function(a,b){ return (game.scores[b.id]||0)-(game.scores[a.id]||0); });
var medals = ['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'];
var tbl = document.getElementById('e-scores'); tbl.innerHTML='';
players.forEach(function(p,i) {
var div = document.createElement('div'); div.className='score-row';
div.innerHTML =
'<div class="s-rank">'+(medals[i]||'#'+(i+1))+'</div>'+
'<div class="pav" style="background:'+p.color+'22;color:'+p.color+'">'+p.avatar+'</div>'+
'<div class="s-name">'+p.name+(p.id===myId?' <span style="font-size:10px;color:var(--text3)">(moi)</span>':'')+'</div>'+
'<div class="s-pts">'+(game.scores[p.id]||0)+'<span class="s-delta">pts</span></div>';
tbl.appendChild(div);
});
var winner = players[0];
document.getElementById('e-winner').textContent = winner?(winner.id===myId?'ğŸ‰ TU AS GAGNÃ‰ !':winner.name.toUpperCase()+' REMPORTE LA PARTIE !'):'';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EVENT LISTENERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.addEventListener('DOMContentLoaded', function() {

// Theme
document.getElementById('theme-btn').addEventListener('click', function() { applyTheme(!isLight); });

// Nav
document.getElementById('back-btn').addEventListener('click', goBack);
document.getElementById('btn-go-create').addEventListener('click', function(){ go('s-create'); });
document.getElementById('btn-go-join').addEventListener('click', function(){ go('s-join'); });

// DifficultÃ©
document.querySelectorAll('.dtile').forEach(function(tile) {
tile.addEventListener('click', function() {
document.querySelectorAll('.dtile').forEach(function(t){ t.classList.remove('on'); });
this.classList.add('on'); selDiff = this.dataset.diff;
});
});

// CatÃ©gories
document.getElementById('chips-wrap').addEventListener('click', function(e) {
var chip = e.target;
while (chip && chip !== this && !chip.classList.contains('chip')) chip = chip.parentElement;
if (!chip || !chip.classList.contains('chip')) return;
var cat = chip.dataset.cat;
if (cat === 'tous') {
document.querySelectorAll('.chip').forEach(function(c){ c.classList.remove('on'); });
chip.classList.add('on'); selCats = ['tous'];
} else {
document.querySelector('.chip[data-cat="tous"]').classList.remove('on');
chip.classList.toggle('on');
selCats = Array.from(document.querySelectorAll('.chip.on')).map(function(c){ return c.dataset.cat; });
if (!selCats.length) { document.querySelector('.chip[data-cat="tous"]').classList.add('on'); selCats=['tous']; }
}
});

// Create
document.getElementById('btn-create').addEventListener('click', createGame);
document.getElementById('btn-create-back').addEventListener('click', function(){ go('s-home'); });

// Join
document.getElementById('btn-join').addEventListener('click', joinGame);
document.getElementById('btn-join-back').addEventListener('click', function(){ go('s-home'); });
var jc = document.getElementById('j-code');
jc.addEventListener('input', function(){ this.value=this.value.toUpperCase().replace(/[^A-Z0-9]/g,''); });
jc.addEventListener('keydown', function(e){ if(e.key==='Enter') joinGame(); });

// Lobby
document.getElementById('l-start').addEventListener('click', startGame);
document.getElementById('btn-copy').addEventListener('click', copyCode);

// Game â€” maÃ®tre
document.getElementById('btn-hint').addEventListener('click', sendHint);
document.getElementById('hint-inp').addEventListener('keydown', function(e){ if(e.key==='Enter') sendHint(); });

// Game â€” devineurs
var gi = document.getElementById('guess-inp');
gi.addEventListener('input', function(){ this.value=this.value.toUpperCase(); });
gi.addEventListener('keydown', function(e){ if(e.key==='Enter') submitGuess(); });
document.getElementById('btn-guess').addEventListener('click', submitGuess);

// Overlay
document.getElementById('ro-next').addEventListener('click', nextRound);

// End
document.getElementById('btn-replay').addEventListener('click', goHome);
document.getElementById('btn-home-end').addEventListener('click', goHome);
});
</script>

</body>
</html>